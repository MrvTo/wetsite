<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Registration</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 50px auto; 
            padding: 20px;
            background: #f9f9f9;
        }
        .error { 
            background: #ffebee; 
            color: #c62828; 
            padding: 10px; 
            border-radius: 4px; 
            margin: 10px 0;
            display: none;
        }
        .success { 
            background: #e8f5e8; 
            color: #2e7d32; 
            padding: 10px; 
            border-radius: 4px; 
            margin: 10px 0;
        }
        input, select { 
            width: 100%; 
            padding: 10px; 
            margin: 5px 0; 
            border: 1px solid #ddd; 
            border-radius: 4px;
            box-sizing: border-box;
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 12px 20px; 
            border-radius: 4px; 
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        button:hover { background: #0056b3; }
        .form-group { margin: 15px 0; }
        .checkbox-group { margin: 15px 0; }
        input[type="checkbox"] { width: auto; margin-right: 8px; }
    </style>
</head>
<body>
    <h1>üêõ Registration Debug Tool</h1>
    
    <div id="status" class="error" style="display: block;">
        Click "Test Form" to check if everything works
    </div>
    
    <form id="registerForm">
        <div class="form-group">
            <label>First Name:</label>
            <input type="text" id="firstName" name="firstName" value="John" required>
        </div>
        
        <div class="form-group">
            <label>Last Name:</label>
            <input type="text" id="lastName" name="lastName" value="Doe" required>
        </div>
        
        <div class="form-group">
            <label>Email:</label>
            <input type="email" id="email" name="email" value="john@example.com" required>
        </div>
        
        <div class="form-group">
            <label>Password:</label>
            <input type="password" id="password" name="password" value="password123" required>
        </div>
        
        <div class="form-group">
            <label>Confirm Password:</label>
            <input type="password" id="confirmPassword" name="confirmPassword" value="password123" required>
        </div>
        
        <div class="form-group">
            <label>Language:</label>
            <select id="language" name="language">
                <option value="en">English</option>
                <option value="tr">T√ºrk√ße</option>
            </select>
        </div>
        
        <div class="checkbox-group">
            <label>
                <input type="checkbox" id="terms" name="terms" checked required>
                I agree to Terms of Service
            </label>
        </div>
        
        <button type="button" onclick="testForm()">Test Form</button>
        <button type="submit">Submit Registration</button>
    </form>
    
    <div style="margin-top: 30px;">
        <h3>Debug Info:</h3>
        <button onclick="checkAPI()">Check API Connection</button>
        <button onclick="checkConsole()">Check Console Errors</button>
        <pre id="debugInfo" style="background: #f0f0f0; padding: 10px; border-radius: 4px;"></pre>
    </div>

    <script src="js/api.js"></script>
    <script>
        const form = document.getElementById('registerForm');
        const status = document.getElementById('status');
        const debugInfo = document.getElementById('debugInfo');
        
        function showStatus(message, isError = false) {
            status.textContent = message;
            status.className = isError ? 'error' : 'success';
            status.style.display = 'block';
        }
        
        function testForm() {
            debugInfo.textContent = '';
            
            // Test form data extraction
            const formData = new FormData(form);
            const userData = {
                firstName: formData.get('firstName').trim(),
                lastName: formData.get('lastName').trim(),
                email: formData.get('email').toLowerCase().trim(),
                password: formData.get('password'),
                language: formData.get('language') || 'en'
            };
            
            const confirmPassword = formData.get('confirmPassword');
            const termsAccepted = formData.get('terms');
            
            // Validation tests
            let issues = [];
            
            if (!userData.firstName || !userData.lastName || !userData.email || !userData.password) {
                issues.push('‚ùå Missing required fields');
            } else {
                issues.push('‚úÖ All required fields present');
            }
            
            if (userData.password !== confirmPassword) {
                issues.push('‚ùå Passwords do not match');
            } else {
                issues.push('‚úÖ Passwords match');
            }
            
            if (userData.password.length < 8) {
                issues.push('‚ùå Password too short');
            } else {
                issues.push('‚úÖ Password length OK');
            }
            
            if (!termsAccepted) {
                issues.push('‚ùå Terms not accepted');
            } else {
                issues.push('‚úÖ Terms accepted');
            }
            
            debugInfo.textContent = issues.join('\n') + '\n\nForm Data:\n' + JSON.stringify(userData, null, 2);
            
            if (issues.every(i => i.startsWith('‚úÖ'))) {
                showStatus('‚úÖ Form validation passed! Ready for submission.', false);
            } else {
                showStatus('‚ùå Form validation failed. Check debug info below.', true);
            }
        }
        
        async function checkAPI() {
            try {
                showStatus('üîÑ Testing API connection...', false);
                const health = await wetApi.checkHealth();
                
                if (health && health.status === 'OK') {
                    showStatus('‚úÖ API connection successful!', false);
                    debugInfo.textContent = 'API Health Response:\n' + JSON.stringify(health, null, 2);
                } else {
                    showStatus('‚ùå API responded but not healthy', true);
                    debugInfo.textContent = 'API Response:\n' + JSON.stringify(health, null, 2);
                }
            } catch (error) {
                showStatus('‚ùå Cannot connect to API at http://localhost:5000', true);
                debugInfo.textContent = 'API Error:\n' + error.message + '\n\nMake sure your backend server is running!';
            }
        }
        
        function checkConsole() {
            const errors = [];
            
            // Override console methods to catch errors
            const originalError = console.error;
            console.error = function(...args) {
                errors.push('ERROR: ' + args.join(' '));
                originalError.apply(console, args);
            };
            
            const originalWarn = console.warn;
            console.warn = function(...args) {
                errors.push('WARN: ' + args.join(' '));
                originalWarn.apply(console, args);
            };
            
            setTimeout(() => {
                if (errors.length === 0) {
                    showStatus('‚úÖ No console errors detected', false);
                    debugInfo.textContent = 'Console is clean!';
                } else {
                    showStatus('‚ùå Console errors detected', true);
                    debugInfo.textContent = 'Console Errors:\n' + errors.join('\n');
                }
                
                // Restore original console methods
                console.error = originalError;
                console.warn = originalWarn;
            }, 1000);
        }
        
        // Form submission handler
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            showStatus('üîÑ Submitting registration...', false);
            
            const formData = new FormData(form);
            const userData = {
                firstName: formData.get('firstName').trim(),
                lastName: formData.get('lastName').trim(),
                email: formData.get('email').toLowerCase().trim(),
                password: formData.get('password'),
                language: formData.get('language') || 'en'
            };
            
            try {
                const response = await wetApi.register(userData);
                
                if (response && response.success) {
                    showStatus('‚úÖ Registration successful!', false);
                    debugInfo.textContent = 'Registration Response:\n' + JSON.stringify(response, null, 2);
                } else {
                    showStatus('‚ùå Registration failed: ' + (response?.message || 'Unknown error'), true);
                    debugInfo.textContent = 'Registration Response:\n' + JSON.stringify(response, null, 2);
                }
            } catch (error) {
                showStatus('‚ùå Registration error: ' + error.message, true);
                debugInfo.textContent = 'Registration Error:\n' + error.message;
            }
        });
        
        // Auto-test on load
        window.addEventListener('load', () => {
            setTimeout(testForm, 500);
        });
    </script>
</body>
</html>

