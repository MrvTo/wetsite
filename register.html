<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Create Account - W.E.T</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <!-- ✅ Artık firebase-api.js kullanıyoruz -->
  <script type="module" src="js/firebase-api.js"></script>
</head>
<body>
  <!-- ... (tema butonu ve form HTML'i senin gönderdiğin gibi aynı) ... -->

  <script>
    // === Tema ve password toggle kodlarını hiç değiştirmedim ===
    const themeToggle = document.getElementById('themeToggle');
    const themeOverlay = document.getElementById('themeOverlay');
    const root = document.documentElement;

    const savedTheme = localStorage.getItem('theme') || 'dark';
    root.setAttribute('data-theme', savedTheme);
    function toggleTheme() { /* aynı kod */ }
    themeToggle.addEventListener('click', toggleTheme);
    function setupPasswordToggle(inputId, toggleId) { /* aynı kod */ }
    setupPasswordToggle('password', 'passwordToggle');
    setupPasswordToggle('confirmPassword', 'confirmPasswordToggle');

    // === Firebase register entegrasyonu ===
    const form = document.getElementById('registerForm');
    const error = document.getElementById('error');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      error.style.display = 'none';

      const formData = new FormData(form);
      const userData = {
        firstName: formData.get('firstName').trim(),
        lastName: formData.get('lastName').trim(),
        email: formData.get('email').toLowerCase().trim(),
        password: formData.get('password'),
        language: formData.get('language') || 'en'
      };
      const confirmPassword = formData.get('confirmPassword');
      const termsAccepted = formData.get('terms');

      // === Validation ===
      if (!userData.firstName || !userData.lastName || !userData.email || !userData.password) {
        error.textContent = 'All fields are required.';
        error.style.display = 'block';
        return;
      }
      if (userData.password !== confirmPassword) {
        error.textContent = 'Passwords do not match.';
        error.style.display = 'block';
        return;
      }
      if (userData.password.length < 8) {
        error.textContent = 'Password must be at least 8 characters long.';
        error.style.display = 'block';
        return;
      }
      if (!termsAccepted) {
        error.textContent = 'You must agree to the Terms of Service and Privacy Policy.';
        error.style.display = 'block';
        return;
      }

      // === Submit ===
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = 'Creating Account...';

      try {
        // ✅ Firebase üzerinden kayıt
        const response = await window.wetApi.register(userData);

        if (response.success) {
          error.textContent = '✅ Account created! Please verify your email.';
          error.style.display = 'block';
          error.style.color = `rgb(var(--success))`;

          // Ana sayfaya yönlendirme
          setTimeout(() => {
            window.location.href = 'home.html';
          }, 3000);
        } else {
          error.textContent = response.message || 'Registration failed.';
          error.style.display = 'block';
          error.style.color = `rgb(var(--error))`;
        }
      } catch (apiError) {
        console.error('Registration error:', apiError);
        error.textContent = 'Connection error. Please check internet.';
        error.style.display = 'block';
        error.style.color = `rgb(var(--error))`;
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });
  </script>
</body>
</html>
