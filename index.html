<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>W.E.T - Webcam Eye Tracking</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" type="image/svg+xml" href="favicon.svg" />
  <script src="js/api.js"></script>
</head>
<body>
  <!-- Theme Toggle Button -->
  <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
    <div class="theme-toggle-track">
      <div class="theme-toggle-thumb">
        <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"/>
          <path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"/>
        </svg>
        <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </div>
    </div>
  </button>

  <!-- Theme Transition Overlay -->
  <div class="theme-transition-overlay" id="themeOverlay"></div>

  <div class="bg-orbs"></div>
  <div class="bg-lines">
    <div class="line-accent"></div>
  </div>

  <div class="wrap">
    <section class="card" role="dialog" aria-labelledby="title" aria-describedby="subtitle">
      <header class="head">
        <div class="brand" aria-hidden="true">
          <svg viewBox="0 0 100 60" fill="none" aria-hidden="true">
            <!-- Eye shape -->
            <path d="M10 30C25 10, 75 10, 90 30C75 50, 25 50, 10 30Z" 
                  fill="url(#eyeGradient)" stroke="url(#eyeStroke)" stroke-width="2"/>
            
            <!-- Iris -->
            <circle cx="50" cy="30" r="12" fill="url(#irisGradient)"/>
            
            <!-- Pupil -->
            <circle cx="50" cy="30" r="6" fill="#1a1a2e"/>
            
            <!-- Light reflection -->
            <circle cx="52" cy="27" r="2" fill="white" opacity="0.8"/>
            <circle cx="47" cy="29" r="1" fill="white" opacity="0.6"/>
            
            <!-- Gradients -->
            <defs>
              <linearGradient id="eyeGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#00c8ff"/>
                <stop offset="50%" stop-color="#5865f2"/>
                <stop offset="100%" stop-color="#ec4899"/>
              </linearGradient>
              <linearGradient id="eyeStroke" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#0ea5e9"/>
                <stop offset="50%" stop-color="#3b82f6"/>
                <stop offset="100%" stop-color="#a855f7"/>
              </linearGradient>
              <radialGradient id="irisGradient" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="#60a5fa"/>
                <stop offset="70%" stop-color="#3b82f6"/>
                <stop offset="100%" stop-color="#1e40af"/>
              </radialGradient>
            </defs>
          </svg>
        </div>
        <h1 id="title">W.E.T</h1>
        <p id="subtitle" class="sub">webcam eye tracking</p>
      </header>

      <form novalidate>
        <div class="field">
          <input id="email" name="email" type="email" class="input" placeholder=" " autocomplete="email" required />
          <label class="label" for="email">Email</label>
        </div>

        <div class="field">
          <input id="password" name="password" type="password" class="input" placeholder=" " autocomplete="current-password" minlength="8" required />
          <label class="label" for="password">Password</label>
          <button type="button" class="toggle" id="toggle" aria-label="Show password" aria-pressed="false">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
              <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z"/>
              <circle cx="12" cy="12" r="3.5"/>
            </svg>
          </button>
        </div>

        <div class="row">
          <label class="checkbox">
            <input type="checkbox" name="remember" />
            Remember me
          </label>
          <a class="link" href="#">Forgot password?</a>
        </div>

        <button class="btn" type="submit">Sign in</button>
        <p class="error" id="error" role="alert" aria-live="polite"></p>

        <p class="note">New here? <a href="register.html">Create an account</a> or <a href="home.html">visit our main site</a></p>
      </form>
    </section>
  </div>

  <script>
    const passwordInput = document.getElementById('password');
    const toggle = document.getElementById('toggle');
    const error = document.getElementById('error');
    const form = document.querySelector('form');
    const themeToggle = document.getElementById('themeToggle');
    const themeOverlay = document.getElementById('themeOverlay');

    // Theme switching functionality
    let currentTheme = 'dark';
    
    // Initialize theme from localStorage or default to dark
    const savedTheme = localStorage.getItem('theme') || 'dark';
    if (savedTheme === 'light') {
      document.documentElement.setAttribute('data-theme', 'light');
      currentTheme = 'light';
    }

    // Simple click handler for theme toggle
    themeToggle.addEventListener('click', () => {
      toggleTheme();
    });

    // Theme toggle function
    function toggleTheme() {
      const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
      
      // Start the right-to-left transition
      themeOverlay.classList.add('transitioning');
      
      setTimeout(() => {
        // Switch theme
        if (newTheme === 'light') {
          document.documentElement.setAttribute('data-theme', 'light');
        } else {
          document.documentElement.removeAttribute('data-theme');
        }
        currentTheme = newTheme;
        localStorage.setItem('theme', newTheme);
        
        // Complete the transition
        setTimeout(() => {
          themeOverlay.classList.remove('transitioning');
        }, 50);
      }, 400); // Halfway through the transition
    }

    // Password toggle functionality
    toggle.addEventListener('click', () => {
      const isHidden = passwordInput.type === 'password';
      passwordInput.type = isHidden ? 'text' : 'password';
      toggle.setAttribute('aria-pressed', String(isHidden));
      toggle.title = isHidden ? 'Hide password' : 'Show password';
    });

    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      error.style.display = 'none';
      
      const emailValue = document.getElementById('email').value.toLowerCase().trim();
      const passwordValue = document.getElementById('password').value;
      
      // Check for admin demo login
      if (emailValue === 'admin') {
        error.textContent = 'Welcome Admin! Redirecting to dashboard...';
        error.style.display = 'block';
        error.style.color = `rgb(var(--success))`;
        
        // Redirect to admin panel after a short delay
        setTimeout(() => {
          window.location.href = 'admin.html';
        }, 1500);
        return;
      }
      
      if (!form.checkValidity()) {
        error.textContent = 'Please enter a valid email and a password with at least 8 characters.';
        error.style.display = 'block';
        return;
      }
      
      // Show loading state
      const submitBtn = form.querySelector('button[type="submit"]');
      const originalText = submitBtn.textContent;
      submitBtn.disabled = true;
      submitBtn.textContent = 'Signing in...';
      
      try {
        // Attempt login with backend API
        const response = await wetApi.login(emailValue, passwordValue);
        
        if (response.success) {
          // Store tokens and user data
          wetApi.setTokens(response.data.token, response.data.refreshToken);
          wetApi.setUser(response.data.user);
          
          // Show success message
          error.textContent = `Welcome back, ${response.data.user.firstName}!`;
          error.style.display = 'block';
          error.style.color = `rgb(var(--success))`;
          
          // Redirect based on user role
          setTimeout(() => {
            if (response.data.user.role === 'admin') {
              window.location.href = 'admin.html';
            } else {
              window.location.href = 'home.html';
            }
          }, 1500);
          
        } else {
          // Handle login error
          error.textContent = response.message || 'Login failed. Please try again.';
          error.style.display = 'block';
          error.style.color = `rgb(var(--error))`;
        }
        
      } catch (apiError) {
        console.error('Login error:', apiError);
        error.textContent = 'Connection error. Please check your internet connection.';
        error.style.display = 'block';
        error.style.color = `rgb(var(--error))`;
      } finally {
        // Reset button state
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
      }
    });
  </script>
</body>
</html>